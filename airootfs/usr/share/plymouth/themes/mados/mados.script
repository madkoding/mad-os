// madOS Plymouth Theme Script
// Nord-themed boot splash with logo and spinner

// ============ Background ============
Window.SetBackgroundTopColor(0.18, 0.20, 0.25);    // #2E3440 Nord Polar Night
Window.SetBackgroundBottomColor(0.13, 0.15, 0.19);  // Slightly darker at bottom

// ============ Logo ============
logo.image = Image("logo.png");
logo.sprite = Sprite(logo.image);
logo.sprite.SetX(Window.GetWidth() / 2 - logo.image.GetWidth() / 2);
logo.sprite.SetY(Window.GetHeight() / 2 - logo.image.GetHeight() / 2 - 40);
logo.sprite.SetZ(10);
logo.sprite.SetOpacity(1);

// ============ Spinner (dots) ============
// Create a simple dot spinner using Nord accent color (#88C0D0)
NUM_DOTS = 8;
DOT_RADIUS = 6;
SPINNER_RADIUS = 30;

// We'll draw dots as small images
// Since we can't draw primitives, we use the bullet image approach
// Create dots using a simple approach with opacity animation

spinner_x = Window.GetWidth() / 2;
spinner_y = Window.GetHeight() / 2 + logo.image.GetHeight() / 2 + 20;

// Progress text at bottom
message_sprite = Sprite();
message_sprite.SetPosition(spinner_x, spinner_y + 60, 10);

// ============ Progress callback ============
progress = 0;

fun refresh_callback() {
    progress++;

    // Animate a pulsing effect on the logo
    pulse = Math.Abs(Math.Sin(progress * 0.03)) * 0.15 + 0.85;
    logo.sprite.SetOpacity(pulse);
}

Plymouth.SetRefreshFunction(refresh_callback);

// ============ Message callbacks ============
fun display_normal_callback(text) {
    // Don't display normal messages during quiet boot
}

fun display_message_callback(text) {
    // Don't display messages to keep it clean
}

Plymouth.SetDisplayNormalFunction(display_normal_callback);
Plymouth.SetMessageFunction(display_message_callback);

// ============ Password prompt (if needed) ============
fun display_password_callback(prompt, bullets) {
    // Minimal password display for encrypted disks
    msg = Image.Text(prompt, 0.93, 0.94, 0.96); // #ECEFF4
    msg_sprite = Sprite(msg);
    msg_sprite.SetX(Window.GetWidth() / 2 - msg.GetWidth() / 2);
    msg_sprite.SetY(Window.GetHeight() - 100);
    msg_sprite.SetZ(12);

    bullet_str = "";
    for (i = 0; i < bullets; i++) {
        bullet_str += "â— ";
    }
    if (bullet_str != "") {
        bullet_img = Image.Text(bullet_str, 0.53, 0.75, 0.82); // #88C0D0
        bullet_sprite = Sprite(bullet_img);
        bullet_sprite.SetX(Window.GetWidth() / 2 - bullet_img.GetWidth() / 2);
        bullet_sprite.SetY(Window.GetHeight() - 70);
        bullet_sprite.SetZ(12);
    }
}

Plymouth.SetDisplayPasswordFunction(display_password_callback);

// ============ Quit callback ============
fun quit_callback() {
    logo.sprite.SetOpacity(1);
}

Plymouth.SetQuitFunction(quit_callback);
