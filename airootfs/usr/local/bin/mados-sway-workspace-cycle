#!/usr/bin/env bash
# mados-sway-workspace-cycle - Cycle through workspaces 1-5 with wrap-around
#
# Usage: mados-sway-workspace-cycle prev|next
#
# Unlike 'workspace prev/next' which only cycles through existing workspaces,
# this script explicitly switches to the next/previous workspace number in
# the 1-5 range, creating it if necessary.  This ensures Super+Alt+Arrow
# keybindings always move between workspaces even when only one exists.

MAX_WS=5

direction="${1:-next}"

# Get current focused workspace number
current="$(swaymsg -t get_workspaces 2>/dev/null \
    | jq -r '.[] | select(.focused==true) | .num' 2>/dev/null)" || true
[[ -z "$current" || "$current" == "null" ]] && current=1

# Calculate target workspace with wrap-around
if [[ "$direction" == "prev" ]]; then
    target=$(( current - 1 ))
    (( target < 1 )) && target=$MAX_WS
else
    target=$(( current + 1 ))
    (( target > MAX_WS )) && target=1
fi

# Switch to the target workspace (creates it if it doesn't exist)
swaymsg workspace number "$target" 2>/dev/null || true

# Set the wallpaper for the new workspace
exec mados-sway-wallpaper-set "$target"
