# madOS Installer Autostart
# Only launch in live environment (check for archiso)
# Skip if booted via Ventoy (persistence is already configured)

# Check if running in Ventoy
is_ventoy_boot() {
    if [ -f /proc/cmdline ]; then
        cat /proc/cmdline | grep -q "ventoy" && return 0
    fi
    return 1
}

# Only launch installer if NOT in Ventoy mode
if [ -d /run/archiso ] && ! is_ventoy_boot; then
    # Window rules for the installer
    for_window [app_id="install-mados"] floating enable
    for_window [app_id="install-mados"] resize set 900 650
    for_window [app_id="install-mados"] move position center
    for_window [title="madOS"] floating enable
    for_window [title="madOS"] resize set 900 650
    for_window [title="madOS"] move position center

    # Auto-launch installer after a short delay (let Sway fully initialize)
    # Pass Wayland env vars through sudo so GTK can connect to the display
    exec sleep 2 && sudo WAYLAND_DISPLAY=$WAYLAND_DISPLAY XDG_RUNTIME_DIR=$XDG_RUNTIME_DIR /usr/local/bin/install-mados
fi
